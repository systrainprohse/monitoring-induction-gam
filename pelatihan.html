<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitle">Training Dashboard - GAMITAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --bg-light: #f0f4f8;
            --bg-dark: #1e293b;
            --text-light: #1f2937;
            --text-dark: #f1f5f9;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
            background-image: radial-gradient(at 0% 0%, hsla(217, 89%, 70%, 0.2) 0px, transparent 50%), radial-gradient(at 98% 1%, hsla(283, 89%, 70%, 0.2) 0px, transparent 50%);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.6);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .theme-dark .glass-panel {
            background: rgba(51, 65, 85, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .theme-dark {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        .theme-dark .bg-white {
            background-color: #334155 !important;
        }

        .theme-dark .bg-gray-50,
        .theme-dark .bg-gray-100 {
            background-color: #475569 !important;
        }

        .theme-dark .text-gray-800,
        .theme-dark .text-gray-900,
        .theme-dark .text-gray-700,
        .theme-dark .text-gray-600,
        .theme-dark .text-gray-500 {
            color: #f1f5f9 !important;
        }

        .theme-dark .border-gray-200,
        .theme-dark .border-b,
        .theme-dark .border-t {
            border-color: #475569 !important;
        }

        .theme-dark .hover\:bg-gray-100:hover,
        .theme-dark .hover\:bg-gray-50:hover {
            background-color: #4b5a70 !important;
        }

        .theme-dark .shadow-md,
        .theme-dark .shadow-lg {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
        }

        .theme-dark input,
        .theme-dark select {
            background-color: #475569;
            border-color: #64748b;
            color: #f1f5f9;
        }

        .theme-dark input::placeholder {
            color: #94a3b8;
        }

        .theme-dark .sidebar-link.active {
            background-color: #5b21b6;
            color: white;
        }

        .theme-dark .tab-link.active {
            color: #a78bfa !important;
            border-color: #a78bfa !important;
        }

        .theme-dark .pagination button.active {
            background-color: #a78bfa;
            color: #1e293b;
        }

        .sidebar-link.active {
            background-color: #f3e8ff;
            color: #9333ea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .component-loading {
            position: relative;
            min-height: 100px;
            overflow: hidden;
        }

        .component-loading::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: shimmer 1.5s infinite;
        }

        .theme-dark .component-loading::after {
            background: linear-gradient(90deg, transparent, rgba(100, 116, 139, 0.5), transparent);
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .table-controls,
        .pagination {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .pagination {
            gap: 0.5rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #e2e8f0;
            background-color: white;
            cursor: pointer;
        }

        .pagination button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .pagination button.active {
            background-color: #9333ea;
            color: white;
            border-color: #9333ea;
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        th.sortable:hover {
            background-color: #f9fafb;
        }

        .theme-dark th.sortable:hover {
            background-color: #4b5a70;
        }

        th.sortable::after {
            content: '↕';
            position: absolute;
            right: 0.5rem;
            opacity: 0.5;
        }

        th.sortable.sort-asc::after {
            content: '↑';
            opacity: 1;
        }

        th.sortable.sort-desc::after {
            content: '↓';
            opacity: 1;
        }

        .matrix-table-container {
            width: 100%;
            overflow-x: auto;
        }

        .matrix-table {
            border-collapse: collapse;
            width: 100%;
            font-size: 0.8rem;
        }

        .matrix-table th,
        .matrix-table td {
            border: 1px solid #e2e8f0;
            padding: 0.5rem;
            text-align: left;
            white-space: nowrap;
        }

        .theme-dark .matrix-table th,
        .theme-dark .matrix-table td {
            border-color: #475569;
        }

        .matrix-table th {
            background-color: #f8fafc;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .theme-dark .matrix-table th {
            background-color: #334155;
        }

        .matrix-table .th-vertical {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            text-align: left;
            padding: 0.75rem 0.25rem;
            min-width: 30px;
        }

        .matrix-table .sticky-col {
            position: sticky;
            left: 0;
            background-color: #f8fafc;
            z-index: 5;
        }

        .theme-dark .matrix-table .sticky-col {
            background-color: #334155;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background-color: var(--bg-light);
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal-container {
            transform: scale(1);
        }

        .theme-dark .modal-container {
            background-color: var(--bg-dark);
        }

        @media (max-width: 768px) {
            main {
                margin-left: 0 !important;
            }

            #sidebar {
                transform: translateX(-100%);
            }

            #sidebar.show {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body class="theme-light">
    <aside id="sidebar"
        class="fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-50 transition-transform flex flex-col">
        <div class="p-6 border-b">
            <h1 id="company-name-sidebar" class="text-2xl font-bold text-gray-800"><span
                    class="text-purple-600">G</span>AMITAS</h1>
            <p class="text-xs text-gray-500">Integrated Safety System</p>
        </div>
        <nav class="mt-4 flex-1 overflow-y-auto">
            <ul class="space-y-1 px-4">
                <li><a href="./index.html"
                        class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg text-gray-600 hover:bg-gray-100"><i
                            data-lucide="layout-dashboard"></i><span
                            data-translate-key="sidebar_dashboard">Dashboard</span></a></li>
                <li><a href="./induksi.html"
                        class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg text-gray-600 hover:bg-gray-100"><i
                            data-lucide="user-check"></i><span data-translate-key="sidebar_induksi">Induction</span></a>
                </li>
                <li><a href="#" class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg active"><i
                            data-lucide="award"></i><span data-translate-key="sidebar_pelatihan">Internal
                            Training</span></a></li>
                <li><a href="./laporan_insiden.html"
                        class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg text-gray-600 hover:bg-gray-100"><i
                            data-lucide="file-warning"></i><span data-translate-key="sidebar_laporan_insiden">Incident
                            Report</span></a></li>
                <li><a href="#"
                        class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg text-gray-600 hover:bg-gray-100"><i
                            data-lucide="search-check"></i><span
                            data-translate-key="sidebar_laporan_observasi">Observation Report</span></a></li>
            </ul>
        </nav>
        <div class="p-4 border-t"><a href="./index.html"
                class="w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-700 hover:bg-gray-100"><i
                    data-lucide="log-out"></i><span data-translate-key="sidebar_logout">Logout</span></a></div>
    </aside>
    <button id="mobile-menu-toggle" class="fixed top-4 left-4 z-[60] p-2 rounded-lg bg-white shadow-md md:hidden"><i
            data-lucide="menu"></i></button>
    <main class="md:ml-64 p-4 sm:p-6 lg:p-8">
        <header class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-3xl font-bold text-gray-800" data-translate-key="headerTitle">Training Dashboard</h2>
                <p id="last-updated" class="text-xs text-gray-500" data-translate-key="loadingData">Loading data...</p>
            </div>
            <div class="flex items-center space-x-2"><button id="refresh-button"
                    class="p-2 rounded-full hover:bg-gray-100" title="Reload Data"
                    data-translate-title-key="refreshButtonTitle"><i data-lucide="refresh-cw"
                        class="w-5 h-5 text-gray-600"></i></button><button id="theme-toggle"
                    class="p-2 rounded-full hover:bg-gray-100" title="Change Theme"
                    data-translate-title-key="themeButtonTitle"><i data-lucide="sun"
                        class="w-5 h-5 text-gray-600"></i></button>
                <div class="relative"><select id="language-switcher"
                        class="p-2 rounded-md border border-gray-300 bg-white text-gray-700">
                        <option value="en" selected>English</option>
                        <option value="id">Indonesia</option>
                        <option value="ko">한국어</option>
                    </select></div>
            </div>
        </header>
        <div id="error-banner" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
            <p class="font-bold" data-translate-key="errorBannerTitle">Failed to Load Data</p>
            <p id="error-message-content">An error occurred.</p>
        </div>
        <div id="pelatihan-page" class="page-content active">
            <div class="glass-panel p-6 rounded-xl shadow-md">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6 overflow-x-auto" aria-label="Tabs" id="pelatihan-tabs">
                        <a href="#"
                            class="tab-link shrink-0 border-b-2 border-purple-500 px-1 pb-4 text-sm font-medium text-purple-600 active"
                            data-tab="dashboard-pelatihan" data-translate-key="tabDashboard">Training Dashboard</a>
                        <a href="#"
                            class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                            data-tab="pelatihan-manpower" data-translate-key="tabManpower">Manpower Training</a>
                        <a href="#"
                            class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                            data-tab="competency-lx" data-translate-key="tabCompetencyLX">Competency LX List</a>
                        <a href="#"
                            class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                            data-tab="matrix-kompetensi" data-translate-key="tabCompetencyMatrix">Competency Matrix</a>
                        <a href="#"
                            class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                            data-tab="jadwal-pelatihan" data-translate-key="tabSchedule">Training Schedule</a>
                        <a href="#"
                            class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                            data-tab="atmp" data-translate-key="tabATMP">ATMP</a>
                    </nav>
                </div>
                <div class="mt-6">
                    <div id="dashboard-pelatihan-content" class="tab-content active">
                        <div class="space-y-6">
                            <div id="pelatihan-stats-cards" class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                                <div class="bg-white p-4 rounded-lg card component-loading">
                                    <p class="text-sm text-gray-500" data-translate-key="cardTotalCompetencies">Total
                                        Registered Competencies</p>
                                    <p class="text-3xl font-bold text-gray-800">-</p>
                                </div>
                                <div class="bg-white p-4 rounded-lg card component-loading">
                                    <p class="text-sm text-gray-500" data-translate-key="cardTotalManpower">Total
                                        Trained Manpower</p>
                                    <p class="text-3xl font-bold text-gray-800">-</p>
                                </div>
                                <div class="bg-white p-4 rounded-lg card component-loading">
                                    <p class="text-sm text-gray-500" data-translate-key="cardTrainingNeeds">Total
                                        Training Needs</p>
                                    <p class="text-3xl font-bold text-gray-800">-</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div class="lg:col-span-2 bg-white p-6 rounded-lg card component-loading">
                                    <h3 class="text-md font-semibold text-gray-700 mb-4"
                                        data-translate-key="chartTitleDistribution">POP, POM, POU Competency
                                        Distribution Graph</h3>
                                    <div class="h-64"><canvas id="kompetensiChart"></canvas></div>
                                </div>
                                <div class="bg-white p-6 rounded-lg card component-loading">
                                    <h3 class="text-md font-semibold text-gray-700 mb-4"
                                        data-translate-key="chartTitleProgress">Overall Training Progress</h3>
                                    <div class="h-64 flex items-center justify-center"><canvas
                                            id="progressPelatihanChart"></canvas></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div class="lg:col-span-2 bg-white p-6 rounded-lg card component-loading">
                                    <h3 class="text-md font-semibold text-gray-700 mb-4"
                                        data-translate-key="chartTitleTopNeeds">Top 5 Most Needed Trainings</h3>
                                    <div class="h-64"><canvas id="topPelatihanChart"></canvas></div>
                                </div>
                                <div class="bg-white p-6 rounded-lg card component-loading">
                                    <h3 class="text-md font-semibold text-gray-700 mb-4"
                                        data-translate-key="cardUpcomingSchedule">Upcoming Schedule</h3>
                                    <ul id="jadwal-mendatang-list" class="space-y-4"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="pelatihan-manpower-content" class="tab-content">
                        <h3 class="text-lg font-semibold mb-4" data-translate-key="manpowerDetailTitle">Manpower
                            Competency Details</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="md:col-span-1">
                                <div class="mb-4"><input type="text" id="manpower-search"
                                        placeholder="Search manpower name..."
                                        data-translate-placeholder-key="manpowerSearchPlaceholder"
                                        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div class="max-h-96 overflow-y-auto bg-gray-50 p-2 rounded-lg border">
                                    <ul id="manpower-list" class="space-y-1"></ul>
                                </div>
                            </div>
                            <div id="manpower-detail-placeholder"
                                class="md:col-span-2 p-4 border rounded-lg bg-white flex items-center justify-center">
                                <p class="text-gray-500" data-translate-key="manpowerDetailPlaceholder">Select a name
                                    from the list to see competency details.</p>
                            </div>
                        </div>
                    </div>
                    <div id="competency-lx-content" class="tab-content">
                        <h3 class="text-lg font-semibold mb-4" data-translate-key="competencyLXTitle">Competency LX List
                        </h3>
                        <div class="table-controls"><input type="text" id="competency-lx-search"
                                placeholder="Search in table..." data-translate-placeholder-key="tableSearchPlaceholder"
                                class="px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"><select
                                id="competency-lx-per-page"
                                class="px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="10">10 per page</option>
                                <option value="25">25 per page</option>
                                <option value="50" selected>50 per page</option>
                            </select></div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="text-xs text-gray-500 uppercase border-b">
                                        <th class="py-3 px-4 sortable" data-column="competency"
                                            data-translate-key="tableHeaderCompetency">Competency</th>
                                        <th class="py-3 px-4 sortable" data-column="competencyCode"
                                            data-translate-key="tableHeaderCode">Code</th>
                                        <th class="py-3 px-4 sortable" data-column="jenisCompetency"
                                            data-translate-key="tableHeaderType">Type</th>
                                        <th class="py-3 px-4 sortable" data-column="kelompokCompetency"
                                            data-translate-key="tableHeaderGroup">Group</th>
                                        <th class="py-3 px-4 sortable" data-column="peraturan"
                                            data-translate-key="tableHeaderRegulation">Regulation</th>
                                    </tr>
                                </thead>
                                <tbody id="competency-lx-table-body" class="text-sm text-gray-700"></tbody>
                            </table>
                        </div>
                        <div class="flex flex-col sm:flex-row justify-between items-center mt-4">
                            <div id="competency-lx-summary" class="text-sm text-gray-500 mb-2 sm:mb-0"></div>
                            <div id="competency-lx-pagination" class="pagination"></div>
                        </div>
                    </div>
                    <div id="matrix-kompetensi-content" class="tab-content">
                        <h3 class="text-lg font-semibold mb-4" data-translate-key="matrixTitle">Job Competency Matrix
                        </h3>
                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <div class="flex flex-wrap items-center gap-4"><select id="matrix-dept-filter"
                                    class="w-full md:w-auto p-2 border rounded-md"></select><select
                                    id="matrix-section-filter"
                                    class="w-full md:w-auto p-2 border rounded-md"></select><select
                                    id="matrix-jabatan-filter" class="w-full md:w-auto p-2 border rounded-md"></select>
                                <div class="flex flex-wrap gap-x-4 gap-y-2 items-center text-xs ml-auto"><span
                                        class="inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full font-medium bg-green-100 text-green-800">N2:
                                        Sufficiently Needed</span><span
                                        class="inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full font-medium bg-blue-100 text-blue-800">N3:
                                        Independently Capable</span><span
                                        class="inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full font-medium bg-orange-100 text-orange-800">N4:
                                        Needs Supervision</span><span
                                        class="inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full font-medium bg-red-100 text-red-800">N5:
                                        Critically Needed</span></div>
                            </div>
                        </div>
                        <div class="matrix-table-container">
                            <table id="matrix-table" class="matrix-table">
                                <thead></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <div id="jadwal-pelatihan-content" class="tab-content">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                            <h3 class="text-lg font-semibold" data-translate-key="scheduleTitle">Training Schedule -
                                <span id="calendar-month-year"></span>
                            </h3>
                            <div><button id="prev-month" class="p-2 rounded-md hover:bg-gray-100"><i
                                        data-lucide="chevron-left" class="pointer-events-none"></i></button><button
                                    id="next-month" class="p-2 rounded-md hover:bg-gray-100"><i
                                        data-lucide="chevron-right" class="pointer-events-none"></i></button></div>
                        </div>
                        <div id="calendar-grid"
                            class="grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden">
                        </div>
                    </div>
                    <div id="atmp-content" class="tab-content">
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                            <div class="flex">
                                <div class="flex-shrink-0"><i data-lucide="calendar"
                                        class="h-5 w-5 text-yellow-400"></i></div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700"><strong data-translate-key="atmpTitle">Annual
                                            Training Master Plan (ATMP)</strong> - <span
                                            data-translate-key="atmpDescription">This feature is under development. The
                                            ATMP will display a comprehensive annual training plan for all
                                            employees.</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div id="password-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-[101] p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
            <div class="flex justify-between items-center mb-4">
                <h4 class="font-bold text-lg" data-translate-key="passwordModalTitle">Restricted Access</h4><button
                    class="modal-close-btn text-gray-500 hover:text-gray-800 p-2 rounded-full"><i
                        data-lucide="x"></i></button>
            </div>
            <p class="text-sm text-gray-600 mb-4" data-translate-key="passwordModalPrompt">Please enter the password to
                access this page.</p>
            <form id="password-form"><label for="password-input" class="block text-sm font-medium text-gray-700 mb-1"
                    data-translate-key="passwordModalLabel">Password</label><input type="password" id="password-input"
                    class="w-full px-3 py-2 border rounded-md" required>
                <p id="password-error" class="text-red-500 text-sm mt-1 hidden" data-translate-key="passwordModalError">
                    Incorrect password!</p>
                <div class="flex gap-2 pt-4"><button type="submit"
                        class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-md"
                        data-translate-key="passwordModalUnlock">Unlock</button><button type="button"
                        class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md modal-close-btn"
                        data-translate-key="passwordModalCancel">Cancel</button></div>
            </form>
        </div>
    </div>
    <div id="detail-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="flex justify-between items-center mb-4 border-b pb-4">
                <h2 id="modal-title" class="text-xl font-bold" data-translate-key="modalDetailTitle">Detail</h2><button
                    id="modal-close-button" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="x"
                        class="w-6 h-6 text-gray-600"></i></button>
            </div>
            <div id="modal-content" class="space-y-4"></div>
        </div>
    </div>

    <script>
        const appState = { data: {}, currentTheme: localStorage.getItem('theme') || 'light', currentLang: localStorage.getItem('language') || 'en', cache: { key: 'pelatihan_data_cache_v5', expiry: 1800000 }, tables: {}, lastUpdated: null, targetUrl: null, translations: {}, charts: {}, currentDate: new Date() };
        const API_PELATIHAN_URL = 'https://script.google.com/macros/s/AKfycbyt9baOwMbs4WmXysnxP-kW7-Y_BF7ZASB4OaTdCyDBgbfeC4VwLUOO9k60H1Q4bkqobQ/exec';
        const debounce = (fn, delay) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), delay); }; };
        const showError = (msg) => { const el = document.getElementById('error-banner'); if (el) { el.classList.remove('hidden'); el.querySelector('#error-message-content').textContent = msg; } };

        function fetchData(action, params = {}) {
            return new Promise((resolve, reject) => {
                const cb = 'c' + Math.random().toString(36).slice(-8);
                const url = new URL(API_PELATIHAN_URL); url.search = new URLSearchParams({ action, callback: cb, ...params }).toString();
                const s = document.createElement('script'); s.src = url.href;
                window[cb] = (d) => { delete window[cb]; s.remove(); d.error ? reject(new Error(d.details || d.error)) : resolve(d); };
                s.onerror = () => { delete window[cb]; s.remove(); reject(new Error('Gagal menghubungi server.')); };
                document.head.appendChild(s);
            });
        }

        // ... (All other JS functions will be placed here) ...

        document.addEventListener('DOMContentLoaded', async () => {
            // ... Full initialization logic ...
        });
    </script>
</body>

</html>