<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Induksi & Izin Tambang - GAMITAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --bg-light: #f8fafc;
            --bg-dark: #1e293b;
            --text-light: #1f2937;
            --text-dark: #f1f5f9;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
        }

        .theme-dark {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        .theme-dark .bg-white {
            background-color: #334155 !important;
        }

        .theme-dark .bg-gray-50,
        .theme-dark .bg-gray-100 {
            background-color: #475569 !important;
        }

        .theme-dark .text-gray-800,
        .theme-dark .text-gray-900,
        .theme-dark .text-gray-700,
        .theme-dark .text-gray-600,
        .theme-dark .text-gray-500 {
            color: #f1f5f9 !important;
        }

        .theme-dark .border-gray-200,
        .theme-dark .border-b,
        .theme-dark .border-t {
            border-color: #475569 !important;
        }

        .theme-dark .hover\:bg-gray-100:hover,
        .theme-dark .hover\:bg-gray-50:hover {
            background-color: #4b5a70 !important;
        }

        .theme-dark .shadow-md,
        .theme-dark .shadow-lg {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
        }

        .theme-dark input,
        .theme-dark select {
            background-color: #475569;
            border-color: #64748b;
            color: #f1f5f9;
        }

        .theme-dark input::placeholder {
            color: #94a3b8;
        }

        .theme-dark .sidebar-link.active {
            background-color: #5b21b6;
            color: white;
        }

        .theme-dark .tab-link.active {
            color: #a78bfa !important;
            border-color: #a78bfa !important;
        }

        .theme-dark .pagination button.active {
            background-color: #a78bfa;
            color: #1e293b;
        }

        .sidebar-link.active {
            background-color: #f3e8ff;
            color: #9333ea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .table-controls,
        .pagination {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }

        .pagination {
            gap: 0.5rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #e2e8f0;
            background-color: white;
            cursor: pointer;
        }

        .pagination button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .pagination button.active {
            background-color: #9333ea;
            color: white;
            border-color: #9333ea;
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        th.sortable:hover {
            background-color: #f9fafb;
        }

        .theme-dark th.sortable:hover {
            background-color: #4b5a70;
        }

        th.sortable::after {
            content: '↕';
            position: absolute;
            right: 0.5rem;
            opacity: 0.3;
        }

        th.sortable.sort-asc::after {
            content: '↑';
            opacity: 1;
        }

        th.sortable.sort-desc::after {
            content: '↓';
            opacity: 1;
        }

        .component-loading {
            position: relative;
            min-height: 100px;
            overflow: hidden;
        }

        .component-loading::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: shimmer 1.5s infinite;
        }

        .theme-dark .component-loading::after {
            background: linear-gradient(90deg, transparent, rgba(100, 116, 139, 0.5), transparent);
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            main {
                margin-left: 0 !important;
            }

            #sidebar {
                transform: translateX(-100%);
            }

            #sidebar.show {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body class="theme-light">
    <aside id="sidebar"
        class="fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-50 transition-transform flex flex-col">
        <div class="p-6 border-b">
            <h1 id="company-name-sidebar" class="text-2xl font-bold text-gray-800"><span
                    class="text-purple-600">G</span>AMITAS</h1>
            <p class="text-xs text-gray-500">Integrated Safety System</p>
        </div>
        <nav class="mt-4 flex-1 overflow-y-auto">
            <ul class="space-y-1 px-4">
                <li><a href="./index.html"
                        class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg text-gray-600 hover:bg-gray-100"><i
                            data-lucide="layout-dashboard"></i><span>Dashboard</span></a></li>
                <li><a href="#" class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg active"><i
                            data-lucide="user-check"></i><span>Induksi</span></a></li>
                <li><a href="#"
                        class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg text-gray-600 hover:bg-gray-100"
                        data-external-url="./pelatihan.html"><i data-lucide="award"></i><span>Pelatihan</span></a></li>
                <li><a href="#"
                        class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg text-gray-600 hover:bg-gray-100"
                        data-external-url="./laporan_insiden.html"><i
                            data-lucide="file-warning"></i><span>Insiden</span></a></li>
                <li><a href="#"
                        class="sidebar-link flex items-center space-x-3 px-4 py-2.5 rounded-lg text-gray-600 hover:bg-gray-100"><i
                            data-lucide="search-check"></i><span>Observasi</span></a></li>
            </ul>
        </nav>
        <div class="p-4 border-t"><a href="./index.html"
                class="w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-700 hover:bg-gray-100"><i
                    data-lucide="log-out"></i><span>Logout</span></a></div>
    </aside>
    <button id="mobile-menu-toggle" class="fixed top-4 left-4 z-[60] p-2 rounded-lg bg-white shadow-md md:hidden"><i
            data-lucide="menu"></i></button>
    <main class="md:ml-64 p-4 sm:p-6 lg:p-8">
        <header class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-3xl font-bold text-gray-800">Induksi & Izin Tambang</h2>
                <p id="last-updated" class="text-gray-500 text-sm">Memuat data...</p>
            </div>
            <div class="flex items-center space-x-2"><button id="refresh-button"
                    class="p-2 rounded-full hover:bg-gray-100" title="Muat Ulang"><i
                        data-lucide="refresh-cw"></i></button><button id="theme-toggle"
                    class="p-2 rounded-full hover:bg-gray-100" title="Ganti Tema"><i data-lucide="sun"></i></button>
            </div>
        </header>
        <div id="error-banner" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6">
            <p class="font-bold">Gagal Memuat Data</p>
            <p id="error-message-content"></p>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-md">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-6 overflow-x-auto" id="induksi-tabs">
                    <a href="#"
                        class="tab-link shrink-0 border-b-2 border-purple-500 px-1 pb-4 text-sm font-medium text-purple-600 active"
                        data-tab="dashboard-induksi">Dashboard Induksi</a>
                    <a href="#"
                        class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                        data-tab="new-hire">Induksi New Hire</a>
                    <a href="#"
                        class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                        data-tab="pasca-cuti">Induksi Pasca Cuti</a>
                    <a href="#"
                        class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                        data-tab="temporary">Temporary</a>
                    <a href="#"
                        class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                        data-tab="visitor">Visitor</a>
                    <a href="#"
                        class="tab-link shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-gray-500 hover:border-gray-300"
                        data-tab="absensi">Absensi</a>
                </nav>
            </div>
            <div class="mt-6">
                <div id="dashboard-induksi-content" class="tab-content active">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <div class="flex items-center"><i data-lucide="building-2"
                                    class="w-8 h-8 text-purple-500 mr-4"></i>
                                <div>
                                    <p id="induksi-core-today" class="text-2xl font-bold">0</p>
                                    <p class="text-sm text-gray-500">Induksi Hari Ini (Core)</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <div class="flex items-center"><i data-lucide="users"
                                    class="w-8 h-8 text-green-500 mr-4"></i>
                                <div>
                                    <p id="induksi-mitra-today" class="text-2xl font-bold">0</p>
                                    <p class="text-sm text-gray-500">Induksi Hari Ini (Mitra)</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <div class="flex items-center"><i data-lucide="user" class="w-8 h-8 text-blue-500 mr-4"></i>
                                <div>
                                    <p id="induksi-visitor-today" class="text-2xl font-bold">0</p>
                                    <p class="text-sm text-gray-500">Induksi Hari Ini (Visitor)</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <div class="flex items-center mb-2"><i data-lucide="calendar-check"
                                    class="w-8 h-8 text-orange-500 mr-4"></i>
                                <p class="text-sm text-gray-500">Status Hari Ini</p>
                            </div>
                            <div class="flex justify-around">
                                <div class="text-center">
                                    <p id="status-new-hire" class="text-xl font-bold">0</p>
                                    <p class="text-xs">New Hire</p>
                                </div>
                                <div class="text-center">
                                    <p id="status-cuti" class="text-xl font-bold">0</p>
                                    <p class="text-xs">Cuti</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <h3 class="font-semibold mb-2">Total Induksi per Tipe</h3>
                            <div class="component-loading" style="height: 250px;"><canvas id="chartByType"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <h3 class="font-semibold mb-2">Total Induksi per Perusahaan</h3>
                            <div class="component-loading" style="height: 250px;"><canvas id="chartByCompany"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-50 p-4 rounded-lg shadow card">
                                <h3 class="font-semibold mb-2">Skor Hari Ini</h3>
                                <div id="score-stats-container" class="flex justify-between text-center">...</div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow card flex items-center"><i
                                    data-lucide="key-round" class="w-10 h-10 text-orange-500 mr-4"></i>
                                <div>
                                    <h3 class="font-semibold">Password Hari Ini</h3>
                                    <p id="kode-akses-value" class="text-2xl font-bold">...</p>
                                </div>
                            </div>
                        </div>
                        <div
                            class="bg-gradient-to-br from-green-500 to-emerald-600 text-white p-4 rounded-lg shadow card flex flex-col items-center justify-center text-center">
                            <p id="day-name" class="font-bold text-lg"></p>
                            <p id="date-number" class="text-5xl font-bold"></p>
                            <p id="month-year" class="text-sm"></p>
                            <p id="clock" class="mt-2 text-lg bg-black bg-opacity-20 px-3 py-1 rounded-full"></p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-6 mt-6">
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <h3 class="font-semibold mb-2">Pendaftaran: <span id="total-pendaftaran"
                                    class="font-bold">0</span></h3>
                            <div id="pendaftaran-breakdown" class="overflow-x-auto">
                                <div class="flex gap-4 text-xs"></div>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <h3 class="font-semibold mb-2">Approval Permit: <span id="total-approval"
                                    class="font-bold">0</span></h3>
                            <div id="approval-breakdown" class="overflow-x-auto">
                                <div class="flex gap-4 text-xs"></div>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow card">
                            <h3 class="font-semibold mb-2">Temporary Aktif: <span id="total-temporary"
                                    class="font-bold">0</span></h3>
                            <div id="temporary-breakdown" class="overflow-x-auto">
                                <div class="flex gap-4 text-xs"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="new-hire-content" class="tab-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Data Induksi Karyawan Baru</h3><button id="add-new-hire-btn"
                            class="bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center gap-2"><i
                                data-lucide="plus"></i><span>Tambah</span></button>
                    </div>
                    <div class="table-controls"><input id="new-hire-search" placeholder="Cari..."
                            class="px-3 py-2 border rounded-md"><select id="new-hire-filter">
                            <option value="">Status</option>
                            <option value="ok">OK</option>
                            <option value="hold">Hold</option>
                            <option value="need">Need</option>
                        </select><select id="new-hire-per-page">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50" selected>50</option>
                        </select></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs uppercase border-b">
                                    <th class="p-3 sortable" data-column="date">Tanggal</th>
                                    <th class="p-3 sortable" data-column="nik">NIK</th>
                                    <th class="p-3 sortable" data-column="nama">Nama</th>
                                    <th class="p-3 sortable" data-column="jabatan">Jabatan</th>
                                    <th class="p-3 sortable" data-column="perusahaan">Perusahaan</th>
                                    <th class="p-3 sortable" data-column="status">Status</th>
                                    <th class="p-3 sortable" data-column="score">Skor</th>
                                    <th class="p-3">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="new-hire-table-body"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <div id="new-hire-summary"></div>
                        <div id="new-hire-pagination" class="pagination"></div>
                    </div>
                </div>
                <div id="pasca-cuti-content" class="tab-content">
                    <div class="table-controls"><input id="pasca-cuti-search" placeholder="Cari..."
                            class="px-3 py-2 border rounded-md"><select id="pasca-cuti-filter">
                            <option value="">Status</option>
                            <option value="ok">OK</option>
                            <option value="hold">Hold</option>
                            <option value="need">Need</option>
                        </select><select id="pasca-cuti-per-page">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50" selected>50</option>
                        </select></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs uppercase border-b">
                                    <th class="p-3 sortable" data-column="date">Tanggal</th>
                                    <th class="p-3 sortable" data-column="nik">NIK</th>
                                    <th class="p-3 sortable" data-column="nama">Nama</th>
                                    <th class="p-3 sortable" data-column="jabatan">Jabatan</th>
                                    <th class="p-3 sortable" data-column="perusahaan">Perusahaan</th>
                                    <th class="p-3 sortable" data-column="statusInduksi">Status</th>
                                    <th class="p-3 sortable" data-column="score">Skor</th>
                                    <th class="p-3">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pasca-cuti-table-body"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <div id="pasca-cuti-summary"></div>
                        <div id="pasca-cuti-pagination" class="pagination"></div>
                    </div>
                </div>
                <div id="temporary-content" class="tab-content">
                    <div class="table-controls"><input id="temporary-search" placeholder="Cari..."
                            class="px-3 py-2 border rounded-md"><select id="temporary-filter">
                            <option value="">Status</option>
                            <option value="ok">OK</option>
                            <option value="hold">Hold</option>
                            <option value="need">Need</option>
                        </select><select id="temporary-per-page">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50" selected>50</option>
                        </select></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs uppercase border-b">
                                    <th class="p-3 sortable" data-column="date">Tanggal</th>
                                    <th class="p-3 sortable" data-column="nik">NIK</th>
                                    <th class="p-3 sortable" data-column="nama">Nama</th>
                                    <th class="p-3 sortable" data-column="jabatan">Jabatan</th>
                                    <th class="p-3 sortable" data-column="perusahaan">Perusahaan</th>
                                    <th class="p-3 sortable" data-column="status">Status</th>
                                    <th class="p-3 sortable" data-column="score">Skor</th>
                                    <th class="p-3">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="temporary-table-body"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <div id="temporary-summary"></div>
                        <div id="temporary-pagination" class="pagination"></div>
                    </div>
                </div>
                <div id="visitor-content" class="tab-content">
                    <div class="table-controls"><input id="visitor-search" placeholder="Cari..."
                            class="px-3 py-2 border rounded-md"><select id="visitor-filter">
                            <option value="">Status</option>
                            <option value="ok">OK</option>
                            <option value="hold">Hold</option>
                            <option value="need">Need</option>
                        </select><select id="visitor-per-page">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50" selected>50</option>
                        </select></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs uppercase border-b">
                                    <th class="p-3 sortable" data-column="date">Tanggal</th>
                                    <th class="p-3 sortable" data-column="nik">NIK</th>
                                    <th class="p-3 sortable" data-column="nama">Nama</th>
                                    <th class="p-3 sortable" data-column="jabatan">Jabatan</th>
                                    <th class="p-3 sortable" data-column="perusahaan">Perusahaan</th>
                                    <th class="p-3 sortable" data-column="status">Status</th>
                                    <th class="p-3 sortable" data-column="score">Skor</th>
                                    <th class="p-3">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="visitor-table-body"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <div id="visitor-summary"></div>
                        <div id="visitor-pagination" class="pagination"></div>
                    </div>
                </div>
                <div id="absensi-content" class="tab-content">
                    <div class="table-controls"><input id="pendaftaranInduksi-search" placeholder="Cari..."
                            class="px-3 py-2 border rounded-md"><select id="pendaftaranInduksi-per-page">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50" selected>50</option>
                        </select></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs uppercase border-b">
                                    <th class="p-3 sortable" data-column="timestamp">Waktu</th>
                                    <th class="p-3 sortable" data-column="nama">Nama</th>
                                    <th class="p-3 sortable" data-column="nikKtp">NIK</th>
                                    <th class="p-3 sortable" data-column="perusahaan">Perusahaan</th>
                                    <th class="p-3 sortable" data-column="jenisInduksi">Jenis Induksi</th>
                                    <th class="p-3">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pendaftaranInduksi-table-body"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <div id="pendaftaranInduksi-summary"></div>
                        <div id="pendaftaranInduksi-pagination" class="pagination"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div id="password-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-[101] p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
            <div class="flex justify-between items-center mb-4">
                <h4 class="font-bold text-lg">Akses Terbatas</h4><button class="modal-close-btn"><i
                        data-lucide="x"></i></button>
            </div>
            <p class="text-sm text-gray-600 mb-4">Masukkan password.</p>
            <form id="password-form">
                <div><input type="password" id="password-input" class="w-full px-3 py-2 border rounded-md" required>
                    <p id="password-error" class="text-red-500 text-sm mt-1 hidden">Password salah!</p>
                </div>
                <div class="flex gap-2 pt-4"><button type="submit"
                        class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-md">Buka</button><button type="button"
                        class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md modal-close-btn">Batal</button>
                </div>
            </form>
        </div>
    </div>
    <div id="detail-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-[100] p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h4 class="font-bold text-lg">Detail Data</h4><button class="modal-close-btn"><i
                        data-lucide="x"></i></button>
            </div>
            <div id="detail-modal-body" class="space-y-1 text-sm"></div>
        </div>
    </div>
    <div id="add-data-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-[100] p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h4 class="font-bold text-lg">Tambah Data Baru</h4><button class="modal-close-btn"><i
                        data-lucide="x"></i></button>
            </div>
            <form id="add-data-form" class="space-y-4">
                <div><label class="block text-sm">Nama</label><input type="text" name="nama"
                        class="w-full px-3 py-2 border rounded-md" required></div>
                <div><label class="block text-sm">NIK</label><input type="text" name="nik"
                        class="w-full px-3 py-2 border rounded-md" required></div>
                <div><label class="block text-sm">Jabatan</label><input type="text" name="jabatan"
                        class="w-full px-3 py-2 border rounded-md" required></div>
                <div><label class="block text-sm">Perusahaan</label><input type="text" name="perusahaan"
                        class="w-full px-3 py-2 border rounded-md" required></div>
                <div class="flex gap-2 pt-4"><button type="submit"
                        class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-md">Simpan</button><button
                        type="button"
                        class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md modal-close-btn">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const appState = { currentTheme: localStorage.getItem('theme') || 'light', charts: {}, tables: {}, targetUrl: null };
        const API_URL = 'https://script.google.com/macros/s/AKfycbw8juk3u3DhVpqyNtISFWpLEUDZXG0imkn44fOTVBbLvJils2r-NTjfctIPXod_RSxduw/exec';
        const debounce = (fn, delay) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), delay); }; };
        const showError = (msg) => { const el = document.getElementById('error-banner'); if (el) { el.classList.remove('hidden'); el.querySelector('#error-message-content').textContent = msg; } };

        function updateLastUpdated(ts) { const el = document.getElementById('last-updated'); if (el) el.textContent = ts ? `Diperbarui: ${new Date(ts).toLocaleString('id-ID')}` : 'Memperbarui...'; }
        function updateClock() { const el = document.getElementById('clock'); if (!el) return; const now = new Date(); document.getElementById('day-name').textContent = now.toLocaleDateString('id-ID', { weekday: 'long' }).toUpperCase(); document.getElementById('date-number').textContent = now.getDate(); document.getElementById('month-year').textContent = now.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' }); el.textContent = now.toLocaleTimeString('id-ID', { hour12: false }).replace(/\./g, ':'); }

        function fetchData(action, params = {}) {
            return new Promise((resolve, reject) => {
                const cb = 'c' + Math.random().toString(36).slice(-8);
                const url = new URL(API_URL); url.search = new URLSearchParams({ action, callback: cb, ...params }).toString();
                const s = document.createElement('script'); s.src = url.href;
                window[cb] = (d) => { delete window[cb]; s.remove(); d.error ? reject(new Error(d.details || d.error)) : resolve(d); };
                s.onerror = () => { delete window[cb]; s.remove(); reject(new Error('Gagal menghubungi server.')); };
                document.head.appendChild(s);
            });
        }

        function updateDashboardUI(data) {
            if (!data) return; const { dashboard: d, setting: s } = data;
            const u = (id, val) => { const e = document.getElementById(id); if (e) e.textContent = val ?? '0'; };
            if (s?.namaPerusahaan) { const n = s.namaPerusahaan; document.getElementById('company-name-sidebar').innerHTML = `<span class="text-purple-600">${n[0]}</span>${n.slice(1)}`; }
            u('induksi-core-today', d.induksiCoreToday); u('induksi-mitra-today', d.induksiMitraToday); u('induksi-visitor-today', d.induksiVisitorToday);
            u('status-new-hire', d.statusNewHireToday); u('status-cuti', d.statusCutiToday); u('kode-akses-value', d.kodeAkses);
            const sc = document.getElementById('score-stats-container'); if (sc) sc.innerHTML = `<div><p class="text-xs">Terendah</p><p class="font-bold text-xl">${(d.scoreStats?.terendah || 0).toFixed(1)}</p></div><div><p class="text-xs">Tertinggi</p><p class="font-bold text-xl">${(d.scoreStats?.tertinggi || 0).toFixed(1)}</p></div><div><p class="text-xs">Rata-rata</p><p class="font-bold text-xl">${(d.scoreStats?.rata || 0).toFixed(1)}</p></div>`;
            const rb = (id, t, b) => { const e = document.getElementById(`${id}-breakdown`); if (!e) return; document.getElementById(`total-${id}`).textContent = t; e.querySelector('div').innerHTML = Object.entries(b || {}).sort((a, c) => c[1] - a[1]).map(([n, c]) => `<span class="mx-2">${n}(<span class="font-semibold">${c}</span>)</span>`).join(''); };
            rb('pendaftaran', d.totalPendaftaran, d.pendaftaranBreakdown); rb('approval', d.totalApproval, d.approvalBreakdown); rb('temporary', d.totalTemporary, d.temporaryBreakdown);
        }

        function renderCharts(chartData) {
            if (!chartData) return;
            const colors = ['#9333ea', '#10b981', '#3b82f6', '#f97316', '#ef4444', '#6b7280'];
            const opts = { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 12 } } } };
            const render = (id, type, data, extraOpts = {}) => {
                const ctx = document.getElementById(id)?.getContext('2d'); if (!ctx) return;
                if (appState.charts[id]) appState.charts[id].destroy();
                appState.charts[id] = new Chart(ctx, { type, data, options: { ...opts, ...extraOpts } });
            };
            render('chartByType', 'bar', { labels: Object.keys(chartData.byType), datasets: [{ data: Object.values(chartData.byType), backgroundColor: colors }] }, { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { precision: 0 } } } });
            const coData = Object.entries(chartData.byCompany || {}).sort((a, b) => b[1] - a[1]).slice(0, 7);
            render('chartByCompany', 'pie', { labels: coData.map(d => d[0]), datasets: [{ data: coData.map(d => d[1]), backgroundColor: colors }] }, { scales: { y: { display: false } } });
        }

        class TableManager {
            constructor(key, headers) { this.key = key; this.headers = headers; this.page = 1; this.limit = 50; this.search = ''; this.filter = ''; this.sortBy = null; this.sortOrder = 'desc'; this.loading = false; this.loaded = false; this.initControls(); }
            initControls() {
                const s = document.getElementById(`${this.key}-search`); if (s) s.addEventListener('input', debounce(() => { this.search = s.value; this.fetch(); }, 400));
                const f = document.getElementById(`${this.key}-filter`); if (f) f.addEventListener('change', () => { this.filter = f.value; this.fetch(); });
                const p = document.getElementById(`${this.key}-per-page`); if (p) { this.limit = parseInt(p.value); p.addEventListener('change', () => { this.limit = parseInt(p.value); this.fetch(); }); }
                const pg = document.getElementById(`${this.key}-pagination`); if (pg) pg.addEventListener('click', e => { const b = e.target.closest('.pagination-btn'); if (b && !b.disabled) this.fetch(parseInt(b.dataset.page)); });
                document.getElementById(`${this.key}-content`)?.querySelectorAll('th.sortable').forEach(th => {
                    th.addEventListener('click', () => {
                        const column = th.dataset.column;
                        if (this.sortBy === column) { this.sortOrder = this.sortOrder === 'asc' ? 'desc' : 'asc'; }
                        else { this.sortBy = column; this.sortOrder = 'asc'; }
                        this.updateSortIcons(); this.fetch();
                    });
                });
            }
            updateSortIcons() { document.getElementById(`${this.key}-content`)?.querySelectorAll('th.sortable').forEach(th => { th.classList.remove('sort-asc', 'sort-desc'); if (th.dataset.column === this.sortBy) th.classList.add(`sort-${this.sortOrder}`); }); }
            async fetch(page = 1) {
                if (this.loading) return; this.loading = true; this.loaded = true; this.page = page;
                const tbody = document.getElementById(`${this.key}-table-body`); if (tbody) tbody.innerHTML = `<tr><td colspan="${this.headers.length + 1}" class="text-center p-4 text-gray-500">Memuat...</td></tr>`;
                try {
                    const result = await fetchData('getTableData', { table: this.key, page: this.page, limit: this.limit, search: this.search, filter: this.filter, sortBy: this.sortBy, sortOrder: this.sortOrder });
                    this.render(result.data, result.totalFiltered);
                } catch (error) {
                    if (tbody) tbody.innerHTML = `<tr><td colspan="${this.headers.length + 1}" class="text-center p-4 text-red-500">${error.message}</td></tr>`;
                } finally { this.loading = false; }
            }
            render(data, total) {
                const tbody = document.getElementById(`${this.key}-table-body`); if (!tbody) return;
                const getStatusClass = (value) => {
                    const lower = String(value).toLowerCase();
                    if (lower === 'ok') return 'text-green-600 font-semibold';
                    if (lower === 'hold') return 'text-orange-500 font-semibold';
                    if (lower === 'need') return 'text-red-600 font-semibold';
                    return '';
                };
                tbody.innerHTML = data.length ? data.map(r => `<tr class="border-b hover:bg-gray-50">${this.headers.map(h => {
                    const val = r[h] || '-';
                    const isStatus = h.toLowerCase().includes('status');
                    return `<td class="p-3 ${isStatus ? getStatusClass(val) : ''}">${val}</td>`;
                }).join('')}<td class="p-3"><button class="text-purple-600 hover:underline text-sm detail-btn" data-details='${JSON.stringify(r)}'>Detail</button></td></tr>`).join('') : `<tr><td colspan="${this.headers.length + 1}" class="text-center p-4">Tidak ada data.</td></tr>`;
                const summary = document.getElementById(`${this.key}-summary`); if (summary) summary.textContent = total > 0 ? `Menampilkan ${Math.min((this.page - 1) * this.limit + 1, total)}-${Math.min(this.page * this.limit, total)} dari ${total}` : '0 data';
                const pagination = document.getElementById(`${this.key}-pagination`); if (pagination) {
                    const totalPages = Math.ceil(total / this.limit); if (totalPages <= 1) { pagination.innerHTML = ''; return; }
                    let html = `<button class="pagination-btn" ${this.page === 1 ? 'disabled' : ''} data-page="${this.page - 1}">‹</button>`;
                    for (let i = 1; i <= totalPages; i++) { if (i === this.page) html += `<button class="pagination-btn active" data-page="${i}">${i}</button>`; else if (Math.abs(i - this.page) < 2 || i === 1 || i === totalPages) html += `<button class="pagination-btn" data-page="${i}">${i}</button>`; else if (Math.abs(i - this.page) === 2) html += `<span>...</span>`; }
                    pagination.innerHTML = html + `<button class="pagination-btn" ${this.page === totalPages ? 'disabled' : ''} data-page="${this.page + 1}">›</button>`;
                }
            }
        }

        function showDetailsInModal(data) {
            const m = document.getElementById('detail-modal'); if (!m) return;
            const getStatusClass = (value) => {
                const lower = String(value).toLowerCase();
                if (lower === 'ok') return 'text-green-600 font-semibold';
                if (lower === 'hold') return 'text-orange-500 font-semibold';
                if (lower === 'need') return 'text-red-600 font-semibold';
                return '';
            };
            m.querySelector('#detail-modal-body').innerHTML = '<dl class="grid grid-cols-1 md:grid-cols-2 gap-4">' + Object.entries(data).map(([k, v]) => {
                const isStatus = k.toLowerCase().includes('status');
                return `<div class="bg-gray-50 p-2 rounded"><dt class="font-semibold text-xs text-gray-500">${k.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</dt><dd class="text-gray-800 break-words ${isStatus ? getStatusClass(v) : ''}">${v || '-'}</dd></div>`;
            }).join('') + '</dl>';
            m.classList.remove('hidden');
        }
        function toggleTheme() { appState.currentTheme = appState.currentTheme === "light" ? "dark" : "light"; document.body.classList.toggle("theme-dark", appState.currentTheme === "dark"); localStorage.setItem("theme", appState.currentTheme); document.getElementById("theme-toggle").innerHTML = `<i data-lucide="${appState.currentTheme === 'light' ? 'moon' : 'sun'}"></i>`; lucide.createIcons(); forceRefreshData(true); }
        const CORRECT_PASSWORD = "gamitas2025";
        function requestPassword(url) { if (sessionStorage.getItem('gamitas_access_granted')) { if (url) window.open(url, '_blank'); return; } const m = document.getElementById('password-modal'); appState.targetUrl = url; m.querySelector('#password-input').value = ''; m.querySelector('#password-error').classList.add('hidden'); m.classList.remove('hidden'); m.querySelector('#password-input').focus(); }
        async function forceRefreshData(isThemeChange = false) { const b = document.getElementById('refresh-button'); if (!b) return; b.firstElementChild?.classList.add('animate-spin'); b.disabled = true; if (!isThemeChange) updateLastUpdated(null); try { const data = await fetchData('getDashboardData'); localStorage.setItem('gamitas_dashboard_cache', JSON.stringify({ data, timestamp: Date.now() })); updateDashboardUI(data); renderCharts(data.chartData); updateLastUpdated(Date.now()); } catch (error) { if (!isThemeChange) showError(error.message); } finally { b.firstElementChild?.classList.remove('animate-spin'); b.disabled = false; } }

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons({ attrs: { 'stroke-width': 1.5 } });
            const themeToggle = document.getElementById("theme-toggle");
            if (themeToggle) {
                document.body.classList.toggle("theme-dark", appState.currentTheme === "dark");
                themeToggle.innerHTML = `<i data-lucide="${appState.currentTheme === 'light' ? 'moon' : 'sun'}"></i>`;
                lucide.createIcons();
            }

            const tableKeyMap = { 'dashboard-induksi': null, 'new-hire': 'new-hire', 'pasca-cuti': 'pasca-cuti', 'temporary': 'temporary', 'visitor': 'visitor', 'absensi': 'pendaftaranInduksi' };
            appState.tables = {
                'new-hire': new TableManager('new-hire', ['date', 'nik', 'nama', 'jabatan', 'perusahaan', 'status', 'score']),
                'pasca-cuti': new TableManager('pasca-cuti', ['date', 'nik', 'nama', 'jabatan', 'perusahaan', 'statusInduksi', 'score']),
                'temporary': new TableManager('temporary', ['date', 'nik', 'nama', 'jabatan', 'perusahaan', 'status', 'score']),
                'visitor': new TableManager('visitor', ['date', 'nik', 'nama', 'jabatan', 'perusahaan', 'status', 'score']),
                'pendaftaranInduksi': new TableManager('pendaftaranInduksi', ['timestamp', 'nama', 'nikKtp', 'perusahaan', 'jenisInduksi'])
            };

            const induksiTabs = document.getElementById('induksi-tabs');
            if (induksiTabs) {
                induksiTabs.querySelectorAll('.tab-link').forEach(link => {
                    link.addEventListener('click', e => {
                        e.preventDefault(); const tabId = link.dataset.tab;
                        document.querySelectorAll('.tab-link.active').forEach(l => l.classList.remove('active', 'border-purple-500', 'text-purple-600'));
                        link.classList.add('active', 'border-purple-500', 'text-purple-600');
                        document.querySelectorAll('.tab-content.active').forEach(c => c.classList.remove('active'));
                        document.getElementById(tabId + '-content')?.classList.add('active');
                        const tableKey = tableKeyMap[tabId];
                        if (tableKey && appState.tables[tableKey] && !appState.tables[tableKey].loaded) { appState.tables[tableKey].fetch(1); }
                    });
                });
            }

            document.querySelectorAll('.sidebar-link[data-external-url]').forEach(l => l.addEventListener('click', e => { e.preventDefault(); requestPassword(l.dataset.externalUrl); }));
            if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
            document.getElementById('refresh-button')?.addEventListener('click', () => forceRefreshData(false));
            document.getElementById('add-new-hire-btn')?.addEventListener('click', () => document.getElementById('add-data-modal')?.classList.remove('hidden'));
            document.getElementById('password-form')?.addEventListener('submit', e => { e.preventDefault(); const i = document.getElementById('password-input'); if (i.value === CORRECT_PASSWORD) { sessionStorage.setItem('gamitas_access_granted', 'true'); document.getElementById('password-modal').classList.add('hidden'); if (appState.targetUrl) window.open(appState.targetUrl, '_blank'); } else { document.getElementById('password-error').classList.remove('hidden'); } });

            document.body.addEventListener('click', e => {
                const detailButton = e.target.closest('.detail-btn');
                if (detailButton?.dataset.details) {
                    showDetailsInModal(JSON.parse(detailButton.dataset.details));
                }
                if (e.target.matches('.modal-close-btn,.modal-close-btn *,#detail-modal,#password-modal,#add-data-modal')) {
                    document.querySelectorAll('#detail-modal,#password-modal,#add-data-modal').forEach(m => m.classList.add('hidden'));
                }
            });

            const sb = document.getElementById('sidebar'), tg = document.getElementById('mobile-menu-toggle');
            if (tg && sb) {
                tg.addEventListener('click', e => { e.stopPropagation(); sb.classList.toggle('show'); });
                document.addEventListener('click', e => { if (!sb.contains(e.target) && !tg.contains(e.target)) sb.classList.remove('show'); });
            }

            forceRefreshData(false);
            setInterval(updateClock, 1000);
            updateClock();
        });
    </script>
</body>

</html>